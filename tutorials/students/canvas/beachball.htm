<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
	  canvas{
		display:block;
		margin:20px auto;
		border:1px solid black;
		height:400px;
		width:400px;
	  }
    </style>
	<script type="text/javascript">
	  var width = height = 400;
	  var canvas = ctx = false;
	  var frameRate = 1/40;//sec
	  var frameDelay = frameRate * 1000;//ms
	  var loopTimer = false;

	  var ball = {
		position:		{x:width/2, y:0},
		velocity:		{x:0,y:0},
		mass:			0.1,
		radius:			15,//1px = 1cm
		restitution:	-0.7
	  };

	  var Cd = 0.47;//dim
	  var rho = 1.22;//kg/m^3
	  var A = Math.PI * ball.radius * ball.radius / (10000);
	  var mouse = {x:0,y:0,isDown:false};

	  var getMousePosition = function(e){
		mouse.x = e.pageX - canvas.offsetLeft;
		mouse.y = e.pageY - canvas.offsetTop;
	  }

	  var mouseDown = function(e){
		if(e.which==1){
		  getMousePosition(e);
		  mouse.isDown = true;
		  ball.position.x =  mouse.x;
		  ball.position.y =  mouse.y;
		}
	  }

	  var mouseUp = function(e){
		if(e.which==1){
		  mouse.isDown = false;
		  ball.velocity.y = (ball.position.y - mouse.y)/10;
		  ball.velocity.x = (ball.position.x - mouse.x)/10;
		}
	  }

	  var setup = function(){
		canvas = document.getElementById("canvas");
		ctx = canvas.getContext("2d");

		loopTimer = setInterval(loop,frameDelay);
	  }

	  var loop = function(){
if(!mouse.isDown){
		//PHYSICS

		//drag force: Fd = 1/2 * Cd * A * rho * v.v
		var Fx = -0.5 * Cd * A * rho * ball.velocity.x * ball.velocity.x * ball.velocity.x /	Math.abs(ball.velocity.x);

		var Fy = -0.5 * Cd * A * rho * ball.velocity.y * ball.velocity.y * ball.velocity.y /	Math.abs(ball.velocity.y);

		//calc accel
		Fx = isNaN(Fx)?0:Fx;
		Fy = isNaN(Fy)?0:Fy;

		var ax = Fx / ball.mass;
		var ay = 9.81 + (Fy / ball.mass);

		//integrate to get vel
		ball.velocity.x += ax*frameRate;
		ball.velocity.y += ay*frameRate;

		//integrate to get pos
		ball.position.x += ball.velocity.x * frameRate * 100;
		ball.position.y += ball.velocity.y * frameRate * 100;
}
		//handle collisions
		if(ball.position.y > (height-ball.radius)){
		  ball.velocity.y *= ball.restitution;
		  ball.velocity.y = height - ball.radius;
		}

		if(ball.position.x > (width-ball.radius)){
		  ball.velocity.x *= ball.restitution;
		  ball.position.x = width - ball.radius;
		}

		if(ball.position.x < ball.radius){
		  ball.velocity.x *= ball.restitution;
		  ball.velocity.x = ball.radius;
		}

		//draw ball		
		ctx.clearRect(0,0,width,height);
		ctx.save();
		ctx.translate(ball.position.x,ball.position.y);
		ctx.beginPath();
		ctx.arc(0,0,ball.radius,0,Math.PI*2,true);
		ctx.fill();
		ctx.closePath();
		ctx.restore();

		//draw slingshot
		if(mouse.isDown){
		  ctx.beginPath();
		  ctx.moveTo(ball.position.x,ball.position.y);
		  ctx.lineTo(mouse.x,mouse.y);
		  ctx.stroke();
		  ctx.close;
		}
	  }	  	
	</script>
	<title>Beachball</title>
  </head>
  <body onload="setup();">
	<canvas id="canvas" height="400" width="400">TEST</canvas>
  </body>
</html>